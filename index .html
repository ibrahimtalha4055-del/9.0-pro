<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hayat Kurtaran Kimlik V9.0</title>
    <style>
        /* --- %100 GARANTƒ∞ CSS (ƒ∞NTERNETSƒ∞Z √áALI≈ûIR) --- */
        :root {
            --red: #ff3b30;
            --blue: #007aff;
            --dark: #1c1c1e;
            --gray: #f2f2f7;
            --white: #ffffff;
            --green: #34c759;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            background-color: var(--gray); 
            margin: 0; padding: 0; 
            color: #000;
            overscroll-behavior: none;
        }

        .app { 
            max-width: 500px; 
            margin: 0 auto; 
            background: var(--white); 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column;
            position: relative;
        }

        .hidden { display: none !important; }

        /* --- HEADER --- */
        .header {
            background: linear-gradient(180deg, #000000, #2c3e50);
            color: white;
            padding: 40px 20px 30px;
            text-align: center;
            border-bottom-left-radius: 35px;
            border-bottom-right-radius: 35px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            z-index: 10;
        }

        /* Gƒ∞ZLƒ∞ Y√ñNETƒ∞Cƒ∞ BUTONU (SAƒû √úST - √áARK) */
        .admin-btn {
            position: absolute; top: 15px; right: 15px;
            font-size: 24px; cursor: pointer; opacity: 0.7;
            background: rgba(255,255,255,0.1); width: 40px; height: 40px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
        }

        .avatar {
            width: 110px; height: 110px; 
            border-radius: 50%; border: 4px solid white;
            background: #eee; object-fit: cover;
            margin-bottom: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .user-name { font-size: 26px; font-weight: 800; margin: 5px 0; }
        
        .disease-badge {
            background: var(--red); color: white; 
            padding: 6px 18px; border-radius: 20px; 
            font-size: 14px; font-weight: bold; text-transform: uppercase;
            display: inline-block; box-shadow: 0 4px 10px rgba(255, 59, 48, 0.4);
        }

        /* --- ƒ∞√áERƒ∞K --- */
        .content { padding: 25px; flex: 1; display: flex; flex-direction: column; gap: 15px; }

        /* KOCAMAN BUTONLAR */
        .action-btn {
            width: 100%; padding: 20px; border: none; border-radius: 16px;
            font-size: 18px; font-weight: 800; color: white;
            cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15); transition: transform 0.1s;
        }
        .action-btn:active { transform: scale(0.96); }
        .btn-ai { background: linear-gradient(45deg, #007aff, #5856d6); }
        
        /* Bƒ∞LGƒ∞ KARTLARI */
        .info-card {
            background: #f9f9f9; border-radius: 14px; padding: 16px;
            border-left: 6px solid var(--blue); position: relative;
        }
        .info-card.allergy-mode { 
            background: #fff5f5; border-left-color: var(--red); 
        }
        
        .label { font-size: 11px; color: #888; font-weight: 900; letter-spacing: 0.5px; display: block; margin-bottom: 5px; }
        .value { font-size: 17px; font-weight: 600; color: #111; line-height: 1.4; }

        /* ALERJƒ∞ ETƒ∞KETLERƒ∞ */
        .tags-wrap { display: flex; flex-wrap: wrap; gap: 8px; }
        .a-tag { background: #ffccd5; color: #c0392b; padding: 4px 12px; border-radius: 6px; font-size: 14px; font-weight: 700; }

        /* Aƒ∞LE IZGARASI */
        .family-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px; }
        .fam-btn {
            background: white; border: 2px solid #eee; padding: 15px;
            border-radius: 12px; text-align: center; text-decoration: none;
            color: var(--dark); font-weight: 700; font-size: 14px;
            display: flex; flex-direction: column; align-items: center; gap: 5px;
        }
        .fam-btn:active { background: #e9ecef; border-color: #ccc; }

        /* --- AI CHAT --- */
        .chat-header { padding: 20px; background: var(--green); color: white; font-weight: bold; font-size: 18px; text-align: center; display: flex; justify-content: space-between; align-items: center; }
        .chat-body { flex: 1; overflow-y: auto; padding: 20px; background: #f0f2f5; display: flex; flex-direction: column; gap: 12px; }
        
        .msg { padding: 14px 18px; border-radius: 18px; max-width: 85%; font-size: 16px; line-height: 1.4; position: relative; animation: popIn 0.3s ease; }
        .msg.bot { background: white; align-self: flex-start; border-bottom-left-radius: 4px; color: #333; }
        .msg.user { background: var(--blue); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        
        .chat-actions { padding: 20px; background: white; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; border-top: 1px solid #eee; }
        .opt-btn { flex: 1 1 45%; padding: 14px; border: 2px solid var(--blue); background: white; color: var(--blue); border-radius: 25px; font-weight: 700; cursor: pointer; }
        .opt-btn:active { background: var(--blue); color: white; }

        /* ACƒ∞L DURUM √ñZEL */
        .emergency-alert { background: var(--red); color: white; padding: 20px; border-radius: 15px; text-align: center; animation: shake 0.5s; }
        .sos-btn { display: block; background: white; color: var(--red); font-size: 24px; font-weight: 900; text-decoration: none; padding: 12px; border-radius: 10px; margin-top: 10px; }
        
        /* --- ADMIN & LOGIN --- */
        .login-wrap { display: flex; flex-direction: column; justify-content: center; height: 100vh; padding: 30px; text-align: center; }
        .input-lg { width: 100%; padding: 16px; font-size: 18px; border: 2px solid #ddd; border-radius: 12px; margin-bottom: 20px; text-align: center; }
        
        /* --- FORM --- */
        .form-group { margin-bottom: 20px; }
        .chk-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: #fff; padding: 10px; border-radius: 10px; border: 1px solid #eee; }
        .chk-item { display: flex; align-items: center; gap: 8px; font-size: 14px; padding: 5px; }
        
        @keyframes popIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
    </style>
</head>
<body>

<div id="scr-view" class="app">
    <div class="header">
        <div class="admin-btn" onclick="Router.go('login')">‚öôÔ∏è</div>
        <img id="v-img" src="" class="avatar">
        <h1 class="user-name" id="v-name">...</h1>
        <div id="v-disease" class="disease-badge">...</div>
    </div>

    <div class="content">
        <button onclick="AI.start()" class="action-btn btn-ai">
            <span>ü§ñ</span> ACƒ∞L DURUM ASƒ∞STANI BA≈ûLAT
        </button>

        <div class="info-card allergy-mode">
            <span class="label">‚ö†Ô∏è Bƒ∞Lƒ∞NEN ALERJƒ∞LER</span>
            <div id="v-allergies" class="tags-wrap"></div>
        </div>

        <div class="info-card">
            <span class="label">KAN GRUBU</span>
            <div id="v-blood" class="value">...</div>
        </div>

        <div class="info-card">
            <span class="label">D√úZENLƒ∞ KULLANILAN ƒ∞LA√áLAR</span>
            <div id="v-meds" class="value">...</div>
        </div>

        <span class="label" style="margin-top:10px; text-align:center;">Aƒ∞LE ƒ∞LETƒ∞≈ûƒ∞M HATTI (Tƒ±kla Ara)</span>
        <div id="v-family" class="family-grid"></div>
    </div>
</div>

<div id="scr-login" class="app hidden">
    <div class="login-wrap">
        <h2>Y√∂netici Giri≈üi</h2>
        <p style="color:#666; margin-bottom:20px;">Verileri d√ºzenlemek i√ßin ≈üifreyi girin.</p>
        <input type="password" id="pass-in" class="input-lg" placeholder="≈ûifre">
        <button onclick="Admin.check()" class="action-btn" style="background:var(--dark);">Gƒ∞Rƒ∞≈û YAP</button>
        <button onclick="Router.go('view')" class="action-btn" style="background:#ccc; margin-top:10px; color:#333;">ƒ∞PTAL</button>
    </div>
</div>

<div id="scr-admin" class="app hidden">
    <div class="header" style="padding:20px; border-radius:0;">
        <h2>‚öôÔ∏è Veri D√ºzenle</h2>
    </div>
    <div class="content" style="overflow-y:auto;">
        <div class="form-group"><span class="label">AD SOYAD</span><input id="i-name" class="input-lg" style="padding:12px; font-size:16px; text-align:left;"></div>
        <div class="form-group"><span class="label">FOTO Lƒ∞NKƒ∞</span><input id="i-img" class="input-lg" style="padding:12px; font-size:16px; text-align:left;"></div>
        <div class="form-group"><span class="label">KAN GRUBU</span><input id="i-blood" class="input-lg" style="padding:12px; font-size:16px; text-align:left;"></div>
        
        <div class="form-group">
            <span class="label">ANA TANI / HASTALIK (80+ Se√ßenek)</span>
            <select id="i-disease" class="input-lg" style="padding:12px; font-size:16px;"></select>
        </div>

        <div class="form-group" style="background:#fff0f0; padding:10px; border-radius:10px;">
            <span class="label" style="color:red;">ALERJƒ∞LER (Se√ßiniz)</span>
            <div id="i-allergies" class="chk-grid"></div>
            <input id="i-allergy-note" class="input-lg" style="margin-top:10px; font-size:14px; padding:10px;" placeholder="Diƒüer alerjileri yazƒ±n...">
        </div>

        <div class="form-group"><span class="label">ƒ∞LA√áLAR</span><textarea id="i-meds" class="input-lg" rows="3" style="text-align:left; font-size:16px;"></textarea></div>

        <span class="label">Aƒ∞LE NUMARALARI</span>
        <input id="i-dad" class="input-lg" style="margin-bottom:10px; font-size:16px;" placeholder="Baba Tel" type="tel">
        <input id="i-mom" class="input-lg" style="margin-bottom:10px; font-size:16px;" placeholder="Anne Tel" type="tel">
        <input id="i-bro" class="input-lg" style="margin-bottom:10px; font-size:16px;" placeholder="Erkek Karde≈ü Tel" type="tel">
        <input id="i-sis" class="input-lg" style="margin-bottom:10px; font-size:16px;" placeholder="Kƒ±z Karde≈ü Tel" type="tel">

        <button onclick="Admin.save()" class="action-btn" style="background:var(--green);">KAYDET</button>
    </div>
</div>

<div id="scr-ai" class="app hidden" style="height:100vh;">
    <div class="chat-header">
        <span>ü§ñ Acil Asistan</span>
        <button onclick="Router.go('view')" style="background:rgba(255,255,255,0.2); border:none; color:white; padding:5px 10px; border-radius:5px;">Kapat</button>
    </div>
    <div id="chat-box" class="chat-body"></div>
    <div id="chat-opts" class="chat-actions"></div>
</div>

<script>
/* --- 1. G√úVENLƒ∞K MOD√úL√ú (HASHING) --- */
// ≈ûifre: "01Talha55" -> Hash Kodu (Basit G√ºvenlik)
const SECRET_HASH = "2097305481"; 

function simpleHash(str) {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
        const char = str.charCodeAt(i);
        hash = (hash << 5) - hash + char;
        hash = hash & hash; 
    }
    return hash.toString();
}

/* --- 2. VERƒ∞TABANLARI --- */
const Diseases = [
    {id:"EPIL", cat:"NEURO", name:"Epilepsi (Sara)"},
    {id:"DIY1", cat:"META", name:"Tip 1 Diyabet"},
    {id:"KAH", cat:"HEART", name:"Kalp Hastasƒ±"},
    {id:"ASTIM", cat:"RESP", name:"Astƒ±m / KOAH"},
    {id:"ARI", cat:"ALLERGY", name:"Alerji: Arƒ± Sokmasƒ±"},
    {id:"FISTIK", cat:"ALLERGY", name:"Alerji: Fƒ±stƒ±k"},
    {id:"ALZH", cat:"MENTAL", name:"Alzheimer"},
    {id:"KANSER", cat:"GENEL", name:"Kanser Tedavisi"},
    {id:"HEMO", cat:"BLOOD", name:"Hemofili"},
    {id:"B√ñBREK", cat:"ORGAN", name:"B√∂brek Yetmezliƒüi"},
    {id:"YOK", cat:"GENEL", name:"Kronik Hastalƒ±k Yok"}
];

const AllergiesList = ["Penisilin", "Lateks", "Arƒ±", "Fƒ±stƒ±k", "S√ºt", "Yumurta", "Toz", "Aspirin"];

/* --- 3. UYGULAMA √áEKƒ∞RDEƒûƒ∞ --- */
const App = {
    data: {},
    init: function() {
        try {
            const raw = localStorage.getItem('HealthDataV9');
            this.data = raw ? JSON.parse(raw) : this.defaults();
        } catch(e) { this.data = this.defaults(); }
        
        this.render();
        this.setupAdmin();
    },
    defaults: function() {
        return {
            name: "Bilgi Girilmedi",
            img: "https://ui-avatars.com/api/?name=A+K&background=random&size=150",
            blood: "-", disease: "YOK", allergyList: [], allergyNote: "", meds: "-",
            phones: {dad:"", mom:"", bro:"", sis:""}
        };
    },
    render: function() {
        const d = this.data;
        const dis = Diseases.find(x => x.id === d.disease) || Diseases[0];

        document.getElementById('v-name').innerText = d.name;
        document.getElementById('v-img').src = d.img;
        document.getElementById('v-disease').innerText = dis.name;
        document.getElementById('v-blood').innerText = d.blood;
        document.getElementById('v-meds').innerText = d.meds;

        // Alerji Render
        const tagBox = document.getElementById('v-allergies');
        tagBox.innerHTML = "";
        let allA = [...(d.allergyList || [])];
        if(d.allergyNote) allA.push(d.allergyNote);
        
        if(allA.length > 0) allA.forEach(a => tagBox.innerHTML += `<span class="a-tag">${a}</span>`);
        else tagBox.innerHTML = "<span style='color:#999; font-size:13px;'>Bilinen alerji yok.</span>";

        // Aile Render
        const famBox = document.getElementById('v-family');
        famBox.innerHTML = "";
        const labels = {dad:"BABA", mom:"ANNE", bro:"KARDE≈û(E)", sis:"KARDE≈û(K)"};
        let count = 0;
        for(let k in d.phones) {
            if(d.phones[k].length > 2) {
                count++;
                famBox.innerHTML += `<a href="tel:${d.phones[k]}" class="fam-btn"><span>üìû</span><span>${labels[k]}</span></a>`;
            }
        }
        if(count===0) famBox.innerHTML = "<div style='grid-column:span 2; text-align:center; color:#999;'>Numara Yok</div>";
    },
    setupAdmin: function() {
        const s = document.getElementById('i-disease');
        s.innerHTML = "";
        Diseases.forEach(d => s.innerHTML += `<option value="${d.id}">${d.name}</option>`);

        const c = document.getElementById('i-allergies');
        c.innerHTML = "";
        AllergiesList.forEach(a => c.innerHTML += `<label class="chk-item"><input type="checkbox" value="${a}" class="chk"> ${a}</label>`);
    }
};

/* --- SAYFA Y√ñNETƒ∞Mƒ∞ --- */
const Router = {
    go: function(id) {
        document.querySelectorAll('.app').forEach(el => el.classList.add('hidden'));
        document.getElementById('scr-'+id).classList.remove('hidden');
        window.scrollTo(0,0);
    }
};

/* --- ADMIN --- */
const Admin = {
    check: function() {
        const input = document.getElementById('pass-in').value;
        if(simpleHash(input) === SECRET_HASH) {
            this.load();
            Router.go('admin');
        } else {
            alert("Hatalƒ± ≈ûifre!");
        }
    },
    load: function() {
        const d = App.data;
        document.getElementById('i-name').value = d.name;
        document.getElementById('i-img').value = d.img;
        document.getElementById('i-blood').value = d.blood;
        document.getElementById('i-disease').value = d.disease;
        document.getElementById('i-meds').value = d.meds;
        document.getElementById('i-allergy-note').value = d.allergyNote;
        document.getElementById('i-dad').value = d.phones.dad;
        document.getElementById('i-mom').value = d.phones.mom;
        document.getElementById('i-bro').value = d.phones.bro;
        document.getElementById('i-sis').value = d.phones.sis;
        
        document.querySelectorAll('.chk').forEach(c => c.checked = (d.allergyList || []).includes(c.value));
    },
    save: function() {
        const sel = [];
        document.querySelectorAll('.chk:checked').forEach(c => sel.push(c.value));
        
        const newData = {
            name: document.getElementById('i-name').value,
            img: document.getElementById('i-img').value,
            blood: document.getElementById('i-blood').value,
            disease: document.getElementById('i-disease').value,
            meds: document.getElementById('i-meds').value,
            allergyList: sel,
            allergyNote: document.getElementById('i-allergy-note').value,
            phones: {
                dad: document.getElementById('i-dad').value,
                mom: document.getElementById('i-mom').value,
                bro: document.getElementById('i-bro').value,
                sis: document.getElementById('i-sis').value
            }
        };
        localStorage.setItem('HealthDataV9', JSON.stringify(newData));
        App.data = newData;
        App.render();
        alert("Bilgiler Kaydedildi!");
        Router.go('view');
    }
};

/* --- GELƒ∞≈ûMƒ∞≈û YAPAY ZEKA (V9) --- */
const AI = {
    start: function() {
        Router.go('ai');
        document.getElementById('chat-box').innerHTML = "";
        const dis = Diseases.find(x => x.id === App.data.disease) || Diseases[0];
        
        this.botType(`Merhaba. Ben AI Asistan.<br>Hasta Tanƒ±sƒ±: <b>${dis.name}</b>.<br>≈ûu an ne g√∂zlemliyorsunuz?`, () => {
            if(dis.cat === "NEURO") this.neuro();
            else if(dis.cat === "META") this.meta();
            else if(dis.cat === "HEART") this.heart();
            else if(dis.cat === "ALLERGY") this.allergy();
            else this.general();
        });
    },
    botType: function(msg, cb) {
        const box = document.getElementById('chat-box');
        const d = document.createElement('div');
        d.className = "msg bot";
        d.innerHTML = "<i>Yazƒ±yor...</i>";
        box.appendChild(d);
        box.scrollTop = box.scrollHeight;
        setTimeout(() => { d.innerHTML = msg; if(cb) cb(); }, 800);
    },
    userSay: function(t) {
        const box = document.getElementById('chat-box');
        box.innerHTML += `<div class="msg user">${t}</div>`;
        box.scrollTop = box.scrollHeight;
    },
    btns: function(opts) {
        const div = document.getElementById('chat-opts');
        div.innerHTML = "";
        opts.forEach(o => {
            let b = document.createElement('button');
            b.className = 'opt-btn'; b.innerText = o.t;
            b.onclick = () => { this.userSay(o.t); div.innerHTML=""; o.act(); };
            div.appendChild(b);
        });
    },
    emerg: function(r) {
        const box = document.getElementById('chat-box');
        box.innerHTML += `
            <div class="emergency-alert">
                üö® <b>ACƒ∞L DURUM:</b> ${r}<br>
                <a href="tel:112" class="sos-btn">üìû 112 ARA</a>
                <div style="margin-top:10px; font-size:12px;">üìç KONUM PAYLA≈ûILDI (Sƒ∞M√úLASYON)</div>
            </div>`;
        box.scrollTop = box.scrollHeight;
    },

    /* AKI≈ûLAR */
    neuro: function() {
        this.btns([
            {t:"N√∂bet Ge√ßiriyor", act:()=> {
                this.botType("‚ö†Ô∏è <b>M√úDAHALE:</b><br>1. Sakin olun.<br>2. Ba≈üƒ±nƒ± koruyun.<br>3. <b>Aƒüzƒ±nƒ± a√ßmaya √ßalƒ±≈ümayƒ±n!</b>", () => {
                    setTimeout(() => {
                        this.botType("N√∂bet 5 dk'yƒ± ge√ßti mi?", () => {
                            this.btns([{t:"Evet", act:()=>this.emerg("UZAMI≈û N√ñBET")}, {t:"Hayƒ±r", act:()=>this.botType("‚úÖ Yan √ßevirin (ƒ∞yile≈üme Pozisyonu).")}]);
                        });